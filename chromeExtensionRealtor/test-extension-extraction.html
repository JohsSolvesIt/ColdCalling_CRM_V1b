<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Test Extension Contact Extraction</title>
    <style>
        body { font-family: Arial, sans-serif; padding: 20px; }
        .test-data { background: #f5f5f5; padding: 15px; margin: 10px 0; border-radius: 5px; }
        .result { background: #e8f5e9; padding: 10px; margin: 10px 0; border-left: 4px solid #4caf50; }
        .error { background: #ffebee; padding: 10px; margin: 10px 0; border-left: 4px solid #f44336; }
        button { padding: 10px 20px; margin: 5px; font-size: 16px; }
    </style>
</head>
<body>
    <h1>üß™ Extension Contact Extraction Test</h1>
    
    <div class="test-data">
        <h2>üéØ Sample Contact Data</h2>
        <p><strong>Name:</strong> Becky Prescott</p>
        <p><strong>Phone:</strong> + (207) 942-6711</p>
        <p><strong>Email:</strong> BeckyPrescott@example.com</p>
        <p><strong>Office:</strong> Realty One Group</p>
        <p><strong>Address:</strong> 123 Main Street, Bangor, ME 04401</p>
    </div>

    <button onclick="testContactExtractor()">üîç Test ContactExtractor Module</button>
    <button onclick="testContentScript()">üöÄ Test Content Script Method</button>
    <button onclick="simulateExtension()">‚ö° Simulate Full Extension</button>
    
    <div id="results"></div>

    <!-- Load the exact same scripts as the extension -->
    <script src="modules/core/logging-utils.js"></script>
    <script src="modules/extractors/contact-extractor.js"></script>
    
    <script>
        function addResult(title, content, isError = false) {
            const results = document.getElementById('results');
            const div = document.createElement('div');
            div.className = isError ? 'error' : 'result';
            div.innerHTML = `<h3>${title}</h3><pre>${JSON.stringify(content, null, 2)}</pre>`;
            results.appendChild(div);
        }

        function testContactExtractor() {
            console.log('üß™ Testing ContactExtractor module...');
            
            try {
                if (typeof window.ContactExtractor !== 'undefined') {
                    addResult('‚úÖ ContactExtractor Module Status', 'Module loaded successfully');
                    
                    // Test phone extraction
                    const phone = window.ContactExtractor.extractCleanPhone();
                    addResult('üìû Phone Extraction Result', { phone });
                    
                    // Test email extraction
                    const email = window.ContactExtractor.extractCleanEmail();
                    addResult('üìß Email Extraction Result', { email });
                    
                    // Test office extraction
                    const office = window.ContactExtractor.extractOfficeData();
                    addResult('üè¢ Office Extraction Result', office);
                    
                } else {
                    addResult('‚ùå ContactExtractor Module Error', 'Module not loaded', true);
                }
            } catch (error) {
                addResult('‚ùå ContactExtractor Test Error', { 
                    message: error.message, 
                    stack: error.stack 
                }, true);
            }
        }

        function testContentScript() {
            console.log('üß™ Testing content script extraction methods...');
            
            try {
                // Simulate the content script's extractContactData method
                const contact = {};
                
                // Phone numbers - enhanced extraction with ContactExtractor module
                if (typeof window.ContactExtractor !== 'undefined') {
                    contact.phone = window.ContactExtractor.extractCleanPhone();
                    addResult('‚úÖ Using ContactExtractor for phone', { phone: contact.phone });
                } else {
                    contact.phone = 'FALLBACK_METHOD';
                    addResult('‚ö†Ô∏è Using fallback method for phone', { phone: contact.phone });
                }

                // Email - enhanced extraction with ContactExtractor module
                if (typeof window.ContactExtractor !== 'undefined') {
                    contact.email = window.ContactExtractor.extractCleanEmail();
                    addResult('‚úÖ Using ContactExtractor for email', { email: contact.email });
                } else {
                    contact.email = 'FALLBACK_METHOD';
                    addResult('‚ö†Ô∏è Using fallback method for email', { email: contact.email });
                }

                addResult('üìä Content Script Simulation Result', contact);
                
            } catch (error) {
                addResult('‚ùå Content Script Test Error', { 
                    message: error.message, 
                    stack: error.stack 
                }, true);
            }
        }

        function simulateExtension() {
            console.log('üß™ Simulating full extension behavior...');
            
            try {
                // Check if all required modules are loaded
                const moduleStatus = {
                    ContactExtractor: typeof window.ContactExtractor !== 'undefined',
                    log: typeof window.log !== 'undefined'
                };
                
                addResult('üìã Module Loading Status', moduleStatus);
                
                if (moduleStatus.ContactExtractor) {
                    // Simulate the exact same call that the extension makes
                    const extractedData = {
                        contact: window.ContactExtractor.extractCleanPhone() && window.ContactExtractor.extractCleanEmail() ? 
                            {
                                phone: window.ContactExtractor.extractCleanPhone(),
                                email: window.ContactExtractor.extractCleanEmail(),
                                office: window.ContactExtractor.extractOfficeData()
                            } : 'EXTRACTION_FAILED'
                    };
                    
                    addResult('üéØ Full Extension Simulation', extractedData);
                } else {
                    addResult('‚ùå Extension Simulation Failed', 'ContactExtractor not available', true);
                }
                
            } catch (error) {
                addResult('‚ùå Extension Simulation Error', { 
                    message: error.message, 
                    stack: error.stack 
                }, true);
            }
        }

        // Auto-run tests when page loads
        window.addEventListener('load', () => {
            console.log('üöÄ Page loaded, checking module availability...');
            
            setTimeout(() => {
                const status = {
                    ContactExtractor: typeof window.ContactExtractor !== 'undefined',
                    log: typeof window.log !== 'undefined',
                    timestamp: new Date().toISOString()
                };
                
                addResult('üîç Initial Module Check', status);
                
                if (status.ContactExtractor) {
                    console.log('‚úÖ ContactExtractor is available');
                } else {
                    console.error('‚ùå ContactExtractor is NOT available');
                }
            }, 100);
        });
    </script>
</body>
</html>
